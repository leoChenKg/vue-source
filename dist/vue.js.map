{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组部分方法\r\nlet oldArrayProto = Array.prototype\r\n\r\nexport let newArrayProto = Object.create(oldArrayProto)\r\n\r\n// 这7 个方法可以改变原来的数组\r\nlet methods = ['push', 'pop', 'shift', 'unshift', 'splice', 'reverse', 'sort']\r\n\r\nmethods.forEach(m => {\r\n  //   // 函数劫持 切片编程\r\n  //   if (m === 'push' || m === 'unshift') {\r\n  //     newArrayProto[m] = function (...args) {\r\n  //       console.log('数组增加值，更新视图')\r\n  //       this.__ob__.observeArray(arg)\r\n  //       return oldArrayProto[m].apply(this, args)\r\n  //     }\r\n  //   } else if (m === 'splice') {\r\n  //     newArrayProto[m] = function (...args) {\r\n  //       if (args.length > 2) {\r\n  //         // 有增加的值\r\n  //         let addValues = args.slice(1)\r\n  //         // 递归劫持新增的数据\r\n  //         this.__ob__.observeArray(addValues)\r\n  //       } else {\r\n  //         // 删除值\r\n  //       }\r\n  //       if (args[1] && args[1] > 0) {\r\n  //         console.log('更新数组数据，更新视图')\r\n  //       }\r\n  //       return oldArrayProto[m].apply(this, args)\r\n  //     }\r\n  //   } else {\r\n  //     newArrayProto[m] = function (...args) {\r\n  //       console.log('数组更新，更新视图')\r\n  //       return oldArrayProto[m].apply(this, args)\r\n  //     }\r\n  //   }\r\n\r\n  newArrayProto[m] = function (...args) {\r\n    let result = oldArrayProto[m].apply(this, args)\r\n    let insertedArr\r\n    let ob = this.__ob__\r\n\r\n    switch (m) {\r\n      case 'push':\r\n      case 'unsift':\r\n        insertedArr = args\r\n        break\r\n      case 'splice':\r\n        insertedArr = args.slice(2)\r\n        break\r\n    }\r\n\r\n    if (insertedArr) {\r\n      ob.observeArray(insertedArr)\r\n      console.log('数组改变，视图更新')\r\n    }\r\n    return result\r\n  }\r\n})\r\n","import { newArrayProto } from './array'\r\nclass Observer {\r\n  constructor(data) {\r\n    // 给数据加了一个标识，表示被劫持过了，并搞成不可枚举的，防止 walk  执行时死循环\r\n    Object.defineProperty(data, '__ob__', { enumerable: false, value: this })\r\n    if (Array.isArray(data)) {\r\n      // 如果数据是数组\r\n      this.observeArray(data)\r\n      // 处理数组的劫持问题，重写部分方法\r\n      Object.setPrototypeOf(data, newArrayProto)\r\n    } else {\r\n      // Object.defineProperty 只能劫持对象中已经存在的属性\r\n      this.walk(data)\r\n    }\r\n  }\r\n\r\n  // 循环对象，对属性依次劫持\r\n  walk(data) {\r\n    Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\r\n  }\r\n\r\n  observeArray(data) {\r\n    // 递归劫持数组中的项，只劫持对象，数组单独处理\r\n    data.forEach(item => observe(item))\r\n  }\r\n}\r\n\r\n// 数据劫持功能的函数\r\nexport function defineReactive(target, key, value) {\r\n  // 如果当前值是对象则 继续递归劫持其属性\r\n  observe(value)\r\n  // 劫持数据\r\n  Object.defineProperty(target, key, {\r\n    get() {\r\n      console.log('获取值')\r\n      return value\r\n    },\r\n    set(newVal) {\r\n      if (newVal === value) return\r\n      console.log('数据改变了，去更新页面！')\r\n      observe(newVal)\r\n      value = newVal\r\n    }\r\n  })\r\n}\r\n\r\nexport default function observe(data) {\r\n  // 数据劫持\r\n\r\n  if (typeof data !== 'object' || data == null) {\r\n    return // 不是对象并进行数据劫持\r\n  }\r\n\r\n  // 一个对象只需要劫持一次，判断对象是否被劫持过，可以添加一个实例，用实例来判断是否被劫持过\r\n  if (data.__ob__ instanceof Observer) {\r\n    // 数据已经被代理过了\r\n    return data.__ob__\r\n  }\r\n  return new Observer(data)\r\n}\r\n","import observe from './observe/index'\r\nexport default function initState(vm) {\r\n  const opts = vm.$options\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n}\r\n// 处理 options 上的 data\r\nfunction initData(vm) {\r\n  let data = vm.$options.data // data 可能是函数也可能是对象\r\n  data = typeof data === 'function' ? data.call(this) : data\r\n\r\n  // 在 Vue 实实力上加入 _data 属性其值就是 data\r\n  vm._data = data\r\n  // 把 vm._data.xxx  代理成 vm.xxx\r\n  proxy(vm, vm._data)\r\n  // 劫持数据\r\n  observe(data)\r\n}\r\n\r\n// 把 vm._data.xxx  代理成 vm.xxx\r\nfunction proxy(from, target) {\r\n  Object.keys(target).forEach(key => {\r\n    Object.defineProperty(from, key, {\r\n      get() {\r\n        return target[key]\r\n      },\r\n      set(newVal) {\r\n        target[key] = newVal\r\n      }\r\n    })\r\n  })\r\n}\r\n","import initState from './state'\r\nfunction initMixin(Vue) {\r\n  // 用于初始化操作\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    // vue 实例的方法或属性前面有 $\r\n    // 代表用户传过来的配置选项，把它放在全局上，\r\n    // 这样其他实例方法都能访问\r\n    this.$options = options\r\n\r\n    // 初始化状态\r\n    initState(vm)\r\n  }\r\n}\r\n\r\nexport default initMixin\r\n","import initMixin from './init'\r\nfunction Vue(options) {\r\n  debugger\r\n  this._init(options)\r\n}\r\ninitMixin(Vue) // 扩展了 init 方法\r\nexport default Vue\r\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","m","args","result","apply","insertedArr","ob","__ob__","slice","observeArray","console","log","Observer","data","defineProperty","enumerable","value","isArray","setPrototypeOf","walk","keys","key","defineReactive","item","observe","target","get","set","newVal","initState","vm","opts","$options","initData","call","_data","proxy","from","initMixin","Vue","_init","options"],"mappings":"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"}